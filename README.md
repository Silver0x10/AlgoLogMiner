# ExtractingLogs



# Manifest structure
To make the extractor work properly, the json file must have a structure like the following:
```json
{
    "xesExtensions" : [ ... ],
    "xesGlobals" : [ ... ],
    "xesClassifiers" : [ ... ],
    "switches" : { ... },
    "mappings" : [ ... ]
}
```
<br/>
 
* # xesExtensions
    If present, it contains the list of extensions used in the log. Each extension must have the following structure:
    ```json
    { "name" : "Name here", "prefix" : "Prefix here", "uri" : "Uri here" }
    ```
    * **name**: Extension name;
    * **prefix**: Extension prefix;
    * **uri**: Extension uri.
<br/>
 
* # xesGlobals
    If present, it contains the list of global attributes that the log have to contain. Each global attribute must have the following structure:
    ```json
    { "key" : "Key here", "type" : "Type here", "value" : "Value here", "scope" : "Scope here" }
    ```
    * **key**: Attribute name;
    * **type**: Attribute type (allowed types: [ boolean, bool, int, float, string, date ]);
    * **value**: Default value of the attribute;
    * **scope**: "trace" or "event".
<br/>
 
* # xesClassifiers
    If present, it contains the list of event classifiers that the log have to contain.
    Each event classifier must have the following structure:
    ```json
    {"name" : "Name here", "keys" : [ "Key_1 here", ..., "Key_i here" ]}
    ```
    * **name**: Event classifier name;
    * **keys**: List of classifier keys.   
<br/>
 
* # switches
    If present, it consists of a dictionary whose elements must have the following structure:
    ```json
    "Switch name here>" : {
                "Case here" : "Expanded value here"
            }
    ```
    * **Switch name**: Identifier name of the switch. It must be unique;
    * **Case**: String that represents a contracted form of the mapped value. It must be unique within the single switch;
    * **Expanded value**: Expanded form of the corresponding case. 

    Switches are useful to expand those values within Algorand transactions that have been contracted, usually using integers, to reduce the size of attached data. <br/><br/>
    Both cases and values are treated as strings here, but these strings can contain any type supported by Algorand transactions.
<br/>

* # mappings
    It consists of a list whose elements contain filters and mappings needed to produce the xes file starting from Algorand transactions.
    Each element must have the following structure:
    ```json
    {
        "indexerFilters" : [ ... ],
        "logMappings" : [ ... ]
    }
    ```

    * ## indexerFilters
        Each element of this field is a filter list used for searching the Algorand blockchain throw the V2 Indexer. In particular, each list contains the arguments for a single query provided to the `search_transactions()` function (more details [here](https://developer.algorand.org/docs/features/indexer/)). <br/>
        Every filter list must have the following structure:
        ```json 
        [
            {"key" : "Key_1 here", "val" : "Value_1 here", "type" : "Type_1 here"},
            ...
            {"key" : "<Key_i here>", "val" : "Value_i here", "type" : "Type_i here"}
        ]
        ```
        * **key**: Name of the `indexer.search_transactions()` argument;
        * **val**: Value of the `indexer.search_transactions()` argument;
        * **type**: Type of the `indexer.search_transactions()` argument.
        
        In order to generate the xes log, the combination of transaction sets resulting from queries to the indexer will be used.
    <br/>

    * ## logMappings
        A list of dictionaries with the following structure:
        ```json 
        {
            "mappingName" : "Name here",
            "singleTxnFilters" : { ... },
            "traceMappings" : [ ... ],
            "eventMappings" : [ ... ]                
        }
        ```

        * ### mappingName
            A simple string field with the only purpose of readability.
        
        * ### singleTxnFilters
            Each element of this section is an additional filter specific for the corresponding logMapping and applied to transactions resulting from indexer (see [indexerFilters](#indexerFilters)).<br/>
            The structure of a single filter must be the following:
            ```json
            "Transaction field here" : [ "Value_1 here", ..., "Value_i here" ]
            ```
            * **transaction field**: Value position within transaction. Use `.` to access nested fields;
            * **value**: Value allowed by the filter. Each value is treated as string here, but it can contain any type supported by Algorand transactions.

        * ### traceMappings
            Each element of this list is a dictionary containing the attributes that the traces of the xes file generated by the same _traceMapping_ should have and it is also essential to understand which trace the event corresponding to an examined transaction belongs to (assuming that the transaction meets the requirements declared in the corresponding [eventMapping](#eventMappings)). <br/> <br/>
            All attributes inside a _traceMapping_ must have one the following structures:
            ```json
            "Attribute name here" : { "Mapping type here" : { ... } }
            ```
            or
            ```json
            "Attribute name here" : { "Mapping type here" : { ... }, "nullable" : true or false }
            ```
            * **Attribute name**: Name of the xes attribute, preceded by his extension (if present) using `:` as separator;
            * **Mapping type**: see [mapping types](#mapping-types).
            * **nullable**: If true it means that the attribute is not mandatory so a transaction that doesn't contain the corresponding field is not discarded due to its absence. By default it is set to `false`;
            
            To make the extractor work properly, one attribute inside each _traceMapping_ must be an `identifier:id`:
            ```json
            "identifier:id" : { "Mapping type here" : { ... } }
            ```
            
            N.B. For each _traceMapping_ all transactions resulting from previous filters are analyzed (see [indexerFilters](#indexerFilters) and [singleTxnFilters](#singleTxnFilters)).
        <br/>

        * ### eventMappings
            Each element of this list is a dictionary containing the attributes that an event of the xes should have. Indeed, taking in consideration a single transaction, the event corresponding to an _eventMapping_ is generated if and only if the conditions of each single attribute are satisfied. <br/> <br/>
            All attributes inside an _eventMapping_ must have one of the following structures:
            ```json
            "Attribute name here" : { "Mapping type here" : { ... } }
            ```
            or
            ```json
            "Attribute name here" : { "Mapping type here" : { ... }, "nullable" : true or false }
            ```
            * **Attribute name**: Name of the xes attribute, preceded by his extension (if present) using `:` as separator;
            * **Mapping type**: see [mapping types](#mapping-types).
            * **nullable**: If true it means that the attribute is not mandatory so a transaction that doesn't contain the corresponding field is not discarded due to its absence. By default it is set to `false`;
    <br/> 

    ## Mapping types
    * ### static
        A fixex value for a xes attribute.
        ```json
        "static" : { "value" : "Value here", "type" : "Type here" }
        ```
        * **value**: Value of the xes attribute treated as a string;
        * **type**: Type of the xes attribute.

    * ### parameter
        Extracts the value of the xes attribute from a transaction.
        ```json
        "parameter" : { "key" : "Key here", "type" : "Type here" }
        ```
        * **key**: Value position within transaction. Use `.` to access nested fields;
        * **type**: Type of the xes attribute.

        If the key field is not present in the transaction, the attribute is not generated.

    * ### switch
        Extracts a value from a transaction and expands it to the corresponding value of the declared switch. The xes attribute will contain this expanded value.
        ```json
        "switch" : { "switch" : "Switch name here", "key" : "Key here", "type" : "Type here" }
        ```
        * **switch**: Identifier name of a [switch](#switches);
        * **key**: Value position within transaction. Use `.` to access nested fields;
        * **type**: Type of the xes attribute.

        If the key field is not present in the transaction or the extracted value doesn't correspont to any switch case, the attribute is not generated.

    * ### selector
        Extracts a value from a transaction and compares it to the declared switch case. The xes attribute will contain the expanded value corresponding to the case.
        ```json
        "selector" : { "switch" : "Switch name here", "value" : "Switch case here", "key" : "Key here", "type" : "Type here" }
        ```
        * **switch**: Identifier name of a [switch](#switches);
        * **key**: Value position within transaction. Use `.` to access nested fields;
        * **value**: Switch case of the declared switch;
        * **type**: Type of the xes attribute.

        If the key field is not present in the transaction or the extracted value is not the same as the declared switch case, the attribute is not generated.

    <br/>

<br/>

**See inside [manifests](https://github.com/Silverio-Man/ExtractingLogs/tree/main/manifests) directory to see some examples.**